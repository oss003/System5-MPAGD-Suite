; Game-specific data and events code generated by the compiler ------------------

DEFINEWINDOW 0 1 25 39

DEFINEFONT      0 0 0 0 0 0 0 0
                0 48 48 48 48 0 48 0
                0 108 108 0 0 0 0 0
                0 108 254 108 108 254 108 0
                0 24 126 120 126 30 126 24
                0 230 236 24 48 110 206 0
                0 48 120 48 126 204 126 0
                0 24 48 0 0 0 0 0
                0 12 24 24 24 24 12 0
                0 96 48 48 48 48 96 0
                0 0 60 24 126 24 60 0
                0 0 24 24 126 24 24 0
                0 0 0 0 0 24 24 48
                0 0 0 0 126 0 0 0
                0 0 0 0 0 56 56 0
                0 0 6 12 24 48 96 0
                0 124 206 222 246 230 124 0
                0 56 120 24 24 24 126 0
                0 124 198 6 124 192 254 0
                0 124 198 28 6 198 124 0
                0 24 56 120 216 254 24 0
                0 254 192 252 6 198 124 0
                0 124 192 252 198 198 124 0
                0 254 6 12 24 48 48 0
                0 124 198 124 198 198 124 0
                0 124 198 198 126 6 124 0
                0 0 0 48 0 0 48 0
                0 0 48 0 0 48 48 96
                0 0 12 24 48 24 12 0
                0 0 0 126 0 126 0 0
                0 0 48 24 12 24 48 0
                0 124 198 12 24 0 24 0
                0 124 222 254 254 192 124 0
                0 124 198 198 254 198 198 0
                0 252 198 252 198 198 252 0
                0 124 198 192 192 198 124 0
                0 248 204 198 198 204 248 0
                0 254 192 252 192 192 254 0
                0 254 192 252 192 192 192 0
                0 124 198 192 222 198 124 0
                0 198 198 254 198 198 198 0
                0 126 24 24 24 24 126 0
                0 6 6 6 198 198 124 0
                0 204 216 240 216 204 198 0
                0 192 192 192 192 192 254 0
                0 198 238 254 198 198 198 0
                0 198 230 246 222 206 198 0
                0 124 198 198 198 198 124 0
                0 252 198 198 252 192 192 0
                0 124 198 198 246 222 124 0
                0 252 198 198 252 204 198 0
                0 124 192 124 6 198 124 0
                0 254 48 48 48 48 48 0
                0 198 198 198 198 198 124 0
                0 198 198 198 198 108 56 0
                0 198 198 198 198 254 108 0
                0 198 108 56 56 108 198 0
                0 134 204 120 48 48 48 0
                0 254 12 24 48 96 254 0
                0 30 24 24 24 24 30 0
                0 0 192 96 48 24 12 0
                0 240 48 48 48 48 240 0
                0 48 120 252 48 48 48 0
                0 0 0 0 0 0 0 255
                0 60 102 248 96 96 254 0
                0 0 120 12 124 204 124 0
                0 96 96 124 102 102 124 0
                0 0 60 96 96 96 60 0
                0 12 12 124 204 204 124 0
                0 0 120 204 248 192 124 0
                0 28 48 56 48 48 48 0
                0 0 124 204 204 124 12 120
                0 192 192 248 204 204 204 0
                0 48 0 112 48 48 120 0
                0 12 0 12 12 12 108 56
                0 96 120 112 112 120 108 0
                0 48 48 48 48 48 28 0
                0 0 248 252 252 252 252 0
                0 0 248 204 204 204 204 0
                0 0 120 204 204 204 120 0
                0 0 248 204 204 248 192 192
                0 0 124 204 204 124 12 14
                0 0 60 96 96 96 96 0
                0 0 120 192 120 12 248 0
                0 48 120 48 48 48 28 0
                0 0 204 204 204 204 120 0
                0 0 204 204 120 120 48 0
                0 0 204 252 252 252 120 0
                0 0 204 120 48 120 204 0
                0 0 204 204 204 124 12 120
                0 0 252 24 48 96 252 0
                0 30 24 112 24 24 30 0
                0 24 24 24 24 24 24 0
                0 240 48 28 48 48 240 0
                0 60 120 0 0 0 0 0
                124 198 187 227 227 187 198 124

MAP	WIDTH 3
	STARTSCREEN 0

	255,0,255
ENDMAP

DEFINEMESSAGES
	"SCORE"
	"  HIGH"
	"KC MUNHCKIN"
	" GAME"
	" OVER"
	" NEW HIGH SCORE"

DEFINEBLOCK EMPTYBLOCK   $00,1
DEFINEBLOCK WALLBLOCK    $7f,1
DEFINEBLOCK WALLBLOCK    $00,1
DEFINEBLOCK COLLECTABLE  $28,1

DEFINEBLOCK WALLBLOCK    60,1
DEFINEBLOCK WALLBLOCK    53,1
DEFINEBLOCK WALLBLOCK    45,1
DEFINEBLOCK WALLBLOCK    $6c,1
DEFINEBLOCK WALLBLOCK    44,1
DEFINEBLOCK WALLBLOCK    $2e,1
DEFINEBLOCK WALLBLOCK    $25,1
DEFINEBLOCK WALLBLOCK    $34,1
DEFINEBLOCK WALLBLOCK    $6e,1

; Player front
DEFINESPRITE 3
	100,96,48,56,
	120,123,119,116,
	41,115,115,38

	100,96,48,56,
	120,123,119,116,
	41,112,112,38

	100,96,48,56,
	120,123,119,116,
	43,127,127,39

DEFINESPRITE 2
	100,124,124,56,
	117,127,122,127,
	110,43,55,61

	100,124,124,56,
	117,127,122,127,
	62,107,39,109

; Player right
DEFINESPRITE 2
	100,60,124,36,
	110,119,33,32,
	32,43,47,36

	32,120,116,32,
	110,127,127,61,
	32,43,39,32

; Player left
DEFINESPRITE 2
	40,124,108,56,
	32,34,123,61,
	40,47,39,32

	32,120,116,32,
	110,127,127,61,
	32,43,39,32

; Player up
DEFINESPRITE 2
	116,32,32,120,
	119,125,122,63,
	38,43,35,32

	32,120,116,32,
	110,127,127,61,
	32,43,39,32

; Player down
DEFINESPRITE 2

	100,120,112,32,
	119,63,107,125,
	39,32,32,43

	32,120,116,32,
	110,127,127,61,
	32,43,39,32

; Player kill
DEFINESPRITE 8

100,96,48,56,
120,123,119,116,
41,112,112,38

100,96,48,56,
120,123,119,116,
43,127,127,39

100,96,48,56,
120,123,119,116,
43,33,34,39

100,96,48,56,
120,123,119,116,
32,32,32,32

100,96,48,56,
32,107,55,32,
32,32,32,32

32,32,32,32,
32,42,37,32,
32,32,32,32

40,52,96,36,
44,52,104,44,
54,106,32,101

0,0,0,0
0,0,0,0
0,0,0,0

DEFINESCREEN
	2,2,2,2,2, 2,2,2,2,2, 2,2,2,2,2,2,2,2,2, 2,2,2,2, 2,2,2,2,2, 2,2,2,2,2,2,2,2,2,2, 2
	5,0,0,0,0, 0,0,0,0,0, 5,0,0,0,0,5,0,0,0, 5,0,0,0, 0,0,0,0,0, 5,0,0,0,0,0,0,0,0,0, 5
	5,0,3,3,3, 3,3,3,3,0, 5,0,3,0,0,5,0,0,0, 5,0,3,3, 3,3,3,0,0, 5,0,3,3,3,3,3,3,3,0, 5
	5,0,3,0,0, 0,0,0,0,0, 5,0,3,0,0,5,0,0,0, 5,0,3,0, 0,0,0,0,0, 5,0,3,0,0,0,0,0,0,0, 5
	5,0,3,0,0, 8,8,8,8,8,10,0,3,0,0,6,8,8,8,10,0,3,0, 0,8,8,8,8,10,0,3,0,0,8,8,8,8,8, 5
	5,0,3,0,0, 0,0,0,0,0, 0,0,3,0,0,0,0,0,0, 0,0,3,0, 0,0,0,0,0, 0,0,3,0,0,0,0,0,0,0, 5
	5,0,3,3,3, 3,3,3,3,3, 3,3,3,3,3,3,3,3,3, 3,3,3,3, 3,3,3,3,3, 3,3,3,3,3,3,3,3,0,0, 5
	5,0,3,0,0, 0,0,0,0,0, 0,0,3,0,0,0,0,0,0, 0,0,0,0, 0,0,3,0,0, 0,0,0,0,0,0,0,3,0,0, 5
	5,0,3,0,0, 8,8,8,8,8,11,0,3,0,0,8,8,8,8, 8,8,8,8, 8,0,3,0,0, 4,8,8,8,8,8,0,3,0,0, 5
	5,0,3,0,0, 0,0,0,0,0, 5,0,3,0,0,0,0,0,0, 0,0,0,0, 0,0,3,0,0, 5,0,0,0,0,0,0,3,0,0, 5
	5,0,3,3,3, 3,3,3,0,0, 5,0,3,3,3,3,3,3,3, 3,3,3,3, 3,3,3,0,0, 5,0,3,3,3,3,3,3,0,0, 5
	5,0,0,0,0, 0,0,3,0,0, 5,0,0,0,0,0,0,0,0, 0,0,0,0, 0,0,0,0,0, 5,0,3,0,0,0,0,0,0,0, 5
	6,8,8,8,8, 8,0,3,0,0, 6,8,8,8,8,8,8,8,8, 8,8,8,8, 8,8,8,8,8,10,0,3,0,0,8,8,8,8,8,10
	0,0,0,0,0, 0,0,3,0,0, 0,0,0,0,0,0,0,0,0, 0,0,0,0, 0,0,0,0,0, 0,0,3,0,0,0,0,0,0,0, 0
	3,3,3,3,3, 3,3,3,3,3, 3,3,3,3,3,3,0,0,0, 0,0,3,3, 3,3,3,3,3, 3,3,3,3,3,3,3,3,3,3, 0
	0,0,0,0,0, 0,0,3,0,0, 0,0,0,0,0,0,0,0,0, 0,0,0,0, 0,0,0,0,0, 0,0,3,0,0,0,0,0,0,0, 0
	4,8,8,8,8,11,0,3,0,0, 8,8,8,8,8,4,8,8,8, 8,8,8,8, 4,8,8,8,8, 8,0,3,0,0,4,8,8,8,8,11
	5,0,0,0,0, 5,0,3,0,0, 0,0,0,0,0,5,0,0,0, 0,0,0,0, 5,0,0,0,0, 0,0,3,0,0,5,0,0,0,0, 5
	5,0,3,0,0, 5,0,3,3,3, 3,3,3,0,0,5,0,0,0, 0,0,0,0, 5,0,3,3,3, 3,3,3,0,0,5,0,3,0,0, 5
	5,0,3,0,0, 5,0,3,0,0, 0,0,3,0,0,5,0,0,0, 0,0,0,0, 5,0,3,0,0, 0,0,3,0,0,5,0,3,0,0, 5
	5,0,3,0,0, 5,0,3,0,0, 5,0,3,0,0,6,8,8,8, 8,8,8,8,10,0,3,0,0, 5,0,3,0,0,5,0,3,0,0, 5
	5,0,3,0,0, 0,0,3,0,0, 5,0,3,0,0,0,0,0,0, 0,0,0,0, 0,0,3,0,0, 5,0,3,0,0,0,0,3,0,0, 5
	5,0,3,3,3, 3,3,3,0,0, 5,0,3,3,3,3,3,3,3, 3,3,3,3, 3,3,3,0,0, 5,0,3,3,3,3,3,3,0,0, 5
	5,0,0,0,0, 0,0,0,0,0, 5,0,0,0,0,0,0,0,0, 0,0,0,0, 0,0,0,0,0, 5,0,0,0,0,0,0,0,0,0, 5
	6,8,8,8,8, 8,8,8,8,8, 6,8,8,8,8,8,8,8,8, 8,8,8,8, 8,8,8,8,8, 6,8,8,8,8,8,8,8,8,8,10

SPRITEPOSITION 0,0,39,36
SPRITEPOSITION 1,1,15,36
SPRITEPOSITION 1,1,63,36


DEFINEOBJECT 0,0,40,80
         0,0,0,0,0,0,0,0
         0,0,0,0,0,0,0,0
         0,0,0,0,0,0,0,0
         0,0,0,0,0,0,0,0

;------------------------------------------------------------------
; Pacman
;------------------------------------------------------------------

EVENT PLAYER

 GETBLOCKS		; Check if hit collectable block

 LET M = 0		; Reset animation flag

 IF KEY UP		; Check if key up pressed
  LET IMAGE 4		; If yes, sprite image up	
  LET M = 1		; Set animation flag
  IF CANGOUP		; Check if cangoup
    SPRITEUP		; If yes, move up
  ENDIF
 ENDIF

 IF KEY DOWN		; Check if key down pressed
  LET IMAGE 5		; If yes, sprite image down
  LET M = 1		; Set animation flag
  IF CANGODOWN		; Check if cango down
    SPRITEDOWN		; If yes, move down
  ENDIF
 ENDIF

 IF KEY LEFT		; Check if key left pressed
  LET IMAGE 3		; If yes, sprite left
  LET M = 1		; Set animation flag
  IF CANGOLEFT		; Check if cangoleft
   SPRITELEFT		; If yes move left
   IF X 2		; Check for entering tunnel left
     LET X 71		; If yes, display srite in tunnel right
   ENDIF
  ENDIF
 ENDIF

 IF KEY RIGHT		; Check if key right pressed
  LET IMAGE 2		; If yes, sprite right
  LET M = 1		; Set animation flag
  IF CANGORIGHT		; Check if cangoright
   SPRITERIGHT		; If yes move right
   IF X 72		; Check for entering tunnel right
     LET X 3		; If yes display sprite in tunnel left
   ENDIF
  ENDIF
 ENDIF

 IF M > 0		; Check animation flag
  ANIMATE		; If set animate
 ENDIF

 IF COLLISION 1
  SPAWN 2 6
  REMOVE
  LET Q 1
 ENDIF

;------------------------------------------------------------------
; Ghost
;------------------------------------------------------------------

EVENT SPRITETYPE1

 IF Q 1
  REMOVE
  EXIT
 ENDIF

 LET S 0		; Cangoleft flag
 LET T 0		; Cangoright flag
 LET U 0		; Cangoup flag
 LET V 0		; Cangodown flag

 LET M X		; Calculate nearest crossing location (M,N)
 SUBTRACT 4 FROM M
 DIVIDE M BY 10
 MULTIPLY M BY 10
 ADD 4 TO M

 LET N Y
 SUBTRACT 3 FROM N
 DIVIDE N BY 12
 MULTIPLY N BY 12
 ADD 3 TO N

 IF CANGOLEFT		; Check if cangoleft
  LET S 1		; If yes, set cangoleft flag
 ENDIF

 IF CANGORIGHT		; Check if cangoright
  LET T 1		; If yes, set cangoright flag
 ENDIF

 IF CANGOUP		; Check if cangoup
;  IF Y > 2
   LET U 1		; If yes, set cangoup flag
;  ENDIF
 ENDIF

 IF CANGODOWN		; Check if cangodown
;  IF Y < 63
   LET V 1		; If yes, set cangodown flag
;  ENDIF
 ENDIF

 LET M 0		; Reset on crossing flag

 IF DIRECTION LEFT	; If moving left
  IF CANGOUP		; If cangoup
   LET M 1		; Set on crossing flag
  ENDIF
  IF CANGODOWN		; If cangodown
   LET M 1		; Set on crossing flag
  ENDIF
 ENDIF

 IF DIRECTION RIGHT	; If moving right
  IF CANGOUP		; If cangoup
   LET M 1		; Set on crossing flag
  ENDIF
  IF CANGODOWN		; If cangodown
   LET M 1		; Set on crossing flag
  ENDIF
 ENDIF

 IF DIRECTION UP	; If moving up
  IF CANGOLEFT		; If cangoleft
   LET M 1		; Set on crossing flag
  ENDIF
  IF CANGORIGHT		; If cangoright
   LET M 1		; Set on crossing flag
  ENDIF
 ENDIF

 IF DIRECTION DOWN	; If moving down
  IF CANGOLEFT		; If cangoleft	
   LET M 1		; Set on crossing flag
  ENDIF
  IF CANGORIGHT		; If cangoright
   LET M 1		; Set on crossing flag
  ENDIF
 ENDIF

 IF M 1			; Check if sprite on junction
  IF I 0		; Not end of direction
   IF DIRECTION LEFT
    LET I 1		; Check going vertical
   ENDIF
   IF DIRECTION RIGHT
    LET I 1		; Check going vertical
   ENDIF
   IF DIRECTION UP
    LET I 2		; Check going horizontal
   ENDIF
   IF DIRECTION DOWN
    LET I 2		; Check going horizontal
   ENDIF
  ENDIF
 ENDIF

 IF I 1			; Handle vertical
  GETRANDOM 2
  IF RND 0
   IF U 1
    LET DIRECTION UP
   ELSE
    IF V 1
     LET DIRECTION DOWN
    ENDIF
   ENDIF
  ELSE
   IF V 1
    LET DIRECTION DOWN
   ELSE
    IF U 1
     LET DIRECTION UP
    ENDIF
   ENDIF
  ENDIF
 ENDIF

 IF I 2			; Handle horizontal
  GETRANDOM 2
  IF RND 0
   IF S 1
    LET DIRECTION LEFT
   ELSE
    IF T 1
     LET DIRECTION RIGHT
    ENDIF
   ENDIF
  ELSE
   IF T 1
    LET DIRECTION RIGHT
   ELSE
    IF S 1
     LET DIRECTION LEFT
    ENDIF
   ENDIF
  ENDIF
 ENDIF

 LET I 0		; Check end of horizontal directions
 IF DIRECTION LEFT
  IF S 1
   SPRITELEFT
   IF X 2
    LET X 71
   ENDIF
  ELSE
   LET DIRECTION RIGHT	; Handle going vertical
  ENDIF
 ENDIF 

 IF DIRECTION RIGHT
  IF T 1
   SPRITERIGHT
   IF X 72
    LET X 3
   ENDIF
  ELSE
   LET DIRECTION LEFT	; Handle going vertical
  ENDIF
 ENDIF

 IF DIRECTION UP	; Check end of vertical directions
  IF U 1
   SPRITEUP
  ELSE
   LET DIRECTION DOWN	; Handle horizontal
  ENDIF
 ENDIF

 IF DIRECTION DOWN
  IF V 1
   SPRITEDOWN
  ELSE
   LET DIRECTION UP	; Handle horizontal
  ENDIF
 ENDIF

 ANIMATE SLOW

;------------------------------------------------------------------
;------------------------------------------------------------------

EVENT SPRITETYPE2

 ADD 1 TO SETTINGA
 IF SETTINGA 2
  IF FRAME 7
   REMOVE
   KILL
   EXIT
  ENDIF
  LET SETTINGA 0
  ANIMATE
 ENDIF

EVENT SPRITETYPE3

EVENT SPRITETYPE4

EVENT SPRITETYPE5

EVENT SPRITETYPE6

EVENT SPRITETYPE7

EVENT SPRITETYPE8

EVENT INITSPRITE
 IF TYPE 1
  LET DIRECTION LEFT
 ENDIF
 IF TYPE 2
  LET FRAME 0
 ENDIF

EVENT MAINLOOP1
 INK 6
 LINECOL 0
 INK 4
 AT 0,2:PRINT "SCORE: "
 AT 0,9:SHOWSCORE
 AT 0,30:PRINT "LIVES: "
 AT 0,37:DISPLAY LIVES

EVENT MAINLOOP2

EVENT INTROMENU
 CLS
 PRINTMODE 1
 INK 5
 AT 1,16:PRINT "PACMAN"
 PRINTMODE 0
 INK 1
 AT 5,12:PRINT "Choose controls:"
 INK 3
 AT 10,14:PRINT "1. Keyboard"
 AT 12,14:PRINT "2. Joystick"
 INK 2
 AT 23,8:PRINT "Written by K.v.Oss 2025"
 CONTROLMENU
 LET Q =0
 LET LIVES 3

EVENT GAMEINIT

EVENT RESTARTSCREEN
 PAPER 5
 CLS
 LET D 0

EVENT FELLTOOFAR

EVENT KILLPLAYER
 SUBTRACT 1 FROM LIVES
 LET Q =0
 DELAY 5

EVENT LOSTGAME
 PRINTMODE 1
 INK 1
 AT 13,15:PRINT "GAME OVER"
 PRINTMODE 0
 DELAY 50

EVENT COMPLETEDGAME
 CLS
 PRINTMODE1
 LET C 1
 REPEAT 20
  INK C
  AT 12,12
  PRINT "CONGRATULATIONS!"
  ADD 1 TO C
  IF C 8
   LET C 1
  ENDIF
  DELAY 2
 ENDREPEAT
 PRINTMODE 0

EVENT NEWHIGHSCORE
 LET LINE = 14
 LET COLUMN = 8
 PRINT " NEW HIGH SCORE "

EVENT COLLECTBLOCK
 SCORE 10
 ADD 1 TO D
 IF D 127
  ENDGAME
 ENDIF
