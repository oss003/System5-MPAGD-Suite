; Game-specific data and events code generated by the compiler ------------------

DEFINEWINDOW 0 1 25 39

DEFINEFONT      0 0 0 0 0 0 0 0
                0 48 48 48 48 0 48 0
                0 108 108 0 0 0 0 0
                0 108 254 108 108 254 108 0
                0 24 126 120 126 30 126 24
                0 230 236 24 48 110 206 0
                0 48 120 48 126 204 126 0
                0 24 48 0 0 0 0 0
                0 12 24 24 24 24 12 0
                0 96 48 48 48 48 96 0
                0 0 60 24 126 24 60 0
                0 0 24 24 126 24 24 0
                0 0 0 0 0 24 24 48
                0 0 0 0 126 0 0 0
                0 0 0 0 0 56 56 0
                0 0 6 12 24 48 96 0
                0 124 206 222 246 230 124 0
                0 56 120 24 24 24 126 0
                0 124 198 6 124 192 254 0
                0 124 198 28 6 198 124 0
                0 24 56 120 216 254 24 0
                0 254 192 252 6 198 124 0
                0 124 192 252 198 198 124 0
                0 254 6 12 24 48 48 0
                0 124 198 124 198 198 124 0
                0 124 198 198 126 6 124 0
                0 0 0 48 0 0 48 0
                0 0 48 0 0 48 48 96
                0 0 12 24 48 24 12 0
                0 0 0 126 0 126 0 0
                0 0 48 24 12 24 48 0
                0 124 198 12 24 0 24 0
                0 124 222 254 254 192 124 0
                0 124 198 198 254 198 198 0
                0 252 198 252 198 198 252 0
                0 124 198 192 192 198 124 0
                0 248 204 198 198 204 248 0
                0 254 192 252 192 192 254 0
                0 254 192 252 192 192 192 0
                0 124 198 192 222 198 124 0
                0 198 198 254 198 198 198 0
                0 126 24 24 24 24 126 0
                0 6 6 6 198 198 124 0
                0 204 216 240 216 204 198 0
                0 192 192 192 192 192 254 0
                0 198 238 254 198 198 198 0
                0 198 230 246 222 206 198 0
                0 124 198 198 198 198 124 0
                0 252 198 198 252 192 192 0
                0 124 198 198 246 222 124 0
                0 252 198 198 252 204 198 0
                0 124 192 124 6 198 124 0
                0 254 48 48 48 48 48 0
                0 198 198 198 198 198 124 0
                0 198 198 198 198 108 56 0
                0 198 198 198 198 254 108 0
                0 198 108 56 56 108 198 0
                0 134 204 120 48 48 48 0
                0 254 12 24 48 96 254 0
                0 30 24 24 24 24 30 0
                0 0 192 96 48 24 12 0
                0 240 48 48 48 48 240 0
                0 48 120 252 48 48 48 0
                0 0 0 0 0 0 0 255
                0 60 102 248 96 96 254 0
                0 0 120 12 124 204 124 0
                0 96 96 124 102 102 124 0
                0 0 60 96 96 96 60 0
                0 12 12 124 204 204 124 0
                0 0 120 204 248 192 124 0
                0 28 48 56 48 48 48 0
                0 0 124 204 204 124 12 120
                0 192 192 248 204 204 204 0
                0 48 0 112 48 48 120 0
                0 12 0 12 12 12 108 56
                0 96 120 112 112 120 108 0
                0 48 48 48 48 48 28 0
                0 0 248 252 252 252 252 0
                0 0 248 204 204 204 204 0
                0 0 120 204 204 204 120 0
                0 0 248 204 204 248 192 192
                0 0 124 204 204 124 12 14
                0 0 60 96 96 96 96 0
                0 0 120 192 120 12 248 0
                0 48 120 48 48 48 28 0
                0 0 204 204 204 204 120 0
                0 0 204 204 120 120 48 0
                0 0 204 252 252 252 120 0
                0 0 204 120 48 120 204 0
                0 0 204 204 204 124 12 120
                0 0 252 24 48 96 252 0
                0 30 24 112 24 24 30 0
                0 24 24 24 24 24 24 0
                0 240 48 28 48 48 240 0
                0 60 120 0 0 0 0 0
                124 198 187 227 227 187 198 124

MAP	WIDTH 3
	STARTSCREEN 0

	255,0,255
ENDMAP

DEFINEMESSAGES
	"SCORE"
	"  HIGH"
	"KC MUNHCKIN"
	" GAME"
	" OVER"
	" NEW HIGH SCORE"

DEFINEBLOCK EMPTYBLOCK  $00,1
DEFINEBLOCK WALLBLOCK   $7f,1
DEFINEBLOCK CUSTOMBLOCK  $00,1

; Player front
DEFINESPRITE 3
	100,96,48,56,
	120,123,119,116,
	41,115,115,38

	100,96,48,56,
	120,123,119,116,
	41,112,112,38

	100,96,48,56,
	120,123,119,116,
	43,127,127,39

DEFINESPRITE 2
	100,124,124,56,
	117,127,122,127,
	110,43,55,61

	100,124,124,56,
	117,127,122,127,
	62,107,39,109

; Player right
DEFINESPRITE 2
	100,60,124,36,
	110,119,33,32,
	32,43,47,36

	32,120,116,32,
	110,127,127,61,
	32,43,39,32

; Player left
DEFINESPRITE 2
	40,124,108,56,
	32,34,123,61,
	40,47,39,32

	32,120,116,32,
	110,127,127,61,
	32,43,39,32

; Player up
DEFINESPRITE 2
	116,32,32,120,
	119,125,122,63,
	38,43,35,32

	32,120,116,32,
	110,127,127,61,
	32,43,39,32

; Player down
DEFINESPRITE 2

	100,120,112,32,
	119,63,107,125,
	39,32,32,43

	32,120,116,32,
	110,127,127,61,
	32,43,39,32

DEFINESCREEN
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
	1,2,2,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1
	1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1
	1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1
	1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1
	1,2,2,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,2,2,0,0,0,2,2,0,1
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
	1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1
	1,2,2,0,0,0,0,0,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,2,0,0,0,2,2,0,1
	1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1
	1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1
	1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1
	0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1
	1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1
	1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1
	1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1
	1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1
	1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1
	1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1
	1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1

SPRITEPOSITION 0,0,39,20
SPRITEPOSITION 1,1,39,10


DEFINEOBJECT 0,0,40,80
         0,0,0,0,0,0,0,0
         0,0,0,0,0,0,0,0
         0,0,0,0,0,0,0,0
         0,0,0,0,0,0,0,0

EVENT PLAYER

ADD 1 TO SETTINGA
;IF SETTINGA <> 40
;  EXIT
;ENDIF

;LET SETTINGA 0
 LET M = 0

; LET IMAGE 0

 IF KEY UP
  LET IMAGE 4
  LET M = 1
  IF CANGOUP
    SPRITEUP
  ENDIF
 ENDIF

 IF KEY DOWN
  LET IMAGE 5
  LET M = 1
  IF CANGODOWN
    SPRITEDOWN
  ENDIF
 ENDIF

 IF KEY LEFT
  LET IMAGE 3
  LET M = 1
  IF CANGOLEFT
   IF X > 4
     SPRITELEFT
   ENDIF
  ENDIF
 ENDIF

 IF KEY RIGHT
  LET IMAGE 2
  LET M = 1
  IF CANGORIGHT
   IF X < 70
     SPRITERIGHT
   ENDIF
  ENDIF
 ENDIF

 IF M > 0
  ANIMATE
 ENDIF
 SPRITEINK 7

 IF COLLISION 1
  AT 24,4
  PRINT "HITTING SPRITE:1"
 ELSE
  AT 24,4
  PRINT "HITTING SPRITE: "
 ENDIF

EVENT SPRITETYPE1

;------------------------------------
; Check collision player
;------------------------------------

;  IF COLLISION 0
;    LET I IMAGE
;    REMOVE
;    SPAWN 2 8			; Spawn ghost-eyes
;    SPAWNED
;      LET SETTINGA I		; Remember image
;    ENDSPRITE
;    EXIT
;  ENDIF

;------------------------------------
; Check for leaving home
;------------------------------------

;  IF X 128
;    IF Y 32
;      LET DIRECTION UP
;    ENDIF
;  ENDIF

;------------------------------------
; Check cango directions
;------------------------------------

  LET S 0			; CANGOLEFT
  LET T 0			; CANGORIGHT
  LET U 0			; CANGOUP
  LET V 0			; CANGODOWN

  LET M X
  DIVIDE M BY 8
  MULTIPLY M BY 8
  LET N Y
  DIVIDE N BY 8
  MULTIPLY N BY 8

; Check cangoleft

  LET I X
  LET J 0
  GETBLOCK I Y
  IF BLOCK = FODDERBLOCK
    LET J 1
  ELSE
    SUBTRACT 1 FROM I
    GETBLOCK I Y
    IF BLOCK WALLBLOCK
      LET J 1
    ELSE
      IF BLOCK PLATFORMBLOCK
        LET J 1
      ENDIF
    ENDIF
  ENDIF
  IF J 0
    LET S 1
  ENDIF

; Check cangoright

  LET I X
  LET J 0
  ADD 8 TO I
  GETBLOCK I Y
  IF BLOCK PLATFORMBLOCK
    LET J 1
  ELSE
    IF BLOCK WALLBLOCK
      LET J 1
    ELSE
      ADD 8 TO I
      GETBLOCK I Y
      IF BLOCK FODDERBLOCK
        LET J 1
      ENDIF
    ENDIF
  ENDIF
  IF J 0
    LET T 1
  ENDIF

; Check cangoup

  LET I Y
  LET J 0
  SUBTRACT 1 FROM I
  GETBLOCK X I
  IF BLOCK = LADDERBLOCK
    LET J 1
  ELSE
    IF BLOCK WALLBLOCK
      LET J 1
    ENDIF
  ENDIF
  IF J 0
    LET U 1
  ENDIF

; Check cangodown

  LET I Y
  LET J 0
  GETBLOCK X I
  IF BLOCK = WALLBLOCK
    LET J 1
  ELSE
    IF BLOCK LADDERBLOCK
      LET J 1
    ENDIF
  ENDIF
  IF J 0
    LET V 1
  ENDIF

;------------------------------------
; Check end of horizontal directions
;------------------------------------

  LET I 0
  IF DIRECTION LEFT
    IF S 1
      SPRITELEFT
    ELSE
      LET I 1			; Handle vertical
    ENDIF
  ENDIF 

  IF DIRECTION RIGHT
    IF T 1
      SPRITERIGHT
    ELSE
      LET I 1			; Handle vertical
    ENDIF
  ENDIF

;------------------------------------
; Check end of vertical directions
;------------------------------------

  IF DIRECTION UP
    IF U 1
      SPRITEUP
    ELSE
      LET I 2			; Handle horizontal
    ENDIF
  ENDIF

  IF DIRECTION DOWN
    IF V 1
      SPRITEDOWN
    ELSE
      LET I 2			; Handle horizontal
    ENDIF
  ENDIF

;------------------------------------
; Check if sprite on junction
;------------------------------------

  IF M X
    IF N Y
      IF I 0			; Not end of direction
        IF DIRECTION LEFT
          LET I 1		; Check vertical
        ENDIF
        IF DIRECTION RIGHT
          LET I 1		; Check vertical
        ENDIF
        IF DIRECTION UP
          LET I 2		; Check horizontal
        ENDIF
        IF DIRECTION DOWN
          LET I 2		; Check horizontal
        ENDIF
      ENDIF
    ENDIF
  ENDIF

;------------------------------------
; Handle vertical
;------------------------------------

  IF I 1
    GETRANDOM 2
    IF RND 0
      IF U 1
        LET DIRECTION UP
      ELSE
        IF V 1
          LET DIRECTION DOWN
        ENDIF
      ENDIF
    ELSE
      IF V 1
        LET DIRECTION DOWN
      ELSE
        IF U 1
          LET DIRECTION UP
        ENDIF
      ENDIF
    ENDIF
  ENDIF

;------------------------------------
; Handle horizontal
;------------------------------------

  IF I 2
    GETRANDOM 2
    IF RND 0
      IF S 1
        LET DIRECTION LEFT
      ELSE
        IF T 1
          LET DIRECTION RIGHT
        ENDIF
      ENDIF
    ELSE
      IF T 1
        LET DIRECTION RIGHT
      ELSE
        IF S 1
          LET DIRECTION LEFT
        ENDIF
      ENDIF
    ENDIF
  ENDIF

  ANIMATE SLOW

EVENT SPRITETYPE2

EVENT SPRITETYPE3

EVENT SPRITETYPE4

EVENT SPRITETYPE5

EVENT SPRITETYPE6

EVENT SPRITETYPE7

EVENT SPRITETYPE8

EVENT INITSPRITE
 IF TYPE 1
  LET DIRECTION RIGHT
 ENDIF
 IF TYPE 2
  LET DIRECTION DOWN
 ENDIF

EVENT MAINLOOP1
 DELAY 25

EVENT MAINLOOP2

EVENT INTROMENU
PAPER 5
CLS
AT 12,8:PRINT"TEST"
DELAY 200

EVENT GAMEINIT

EVENT RESTARTSCREEN
 CLS

EVENT FELLTOOFAR

EVENT KILLPLAYER

EVENT LOSTGAME
 PRINTMODE 1
 LET LINE = 8
 LET COLUMN = 13
 COLOUR 87
 PRINT " GAME "
 ADD 2 TO LINE
 LET COLUMN = 13
 COLOUR 86
 PRINT " OVER "
 WAITKEY

EVENT COMPLETEDGAME

EVENT NEWHIGHSCORE
 COLOUR 79
 LET LINE = 14
 LET COLUMN = 8
 PRINT " NEW HIGH SCORE "

EVENT COLLECTBLOCK
